syntax = "proto3";

package authenticator;

import "google/api/annotations.proto";
import "validate/validate.proto";

option go_package = "authenticator/api;api";

// Authenticator ...
service Authenticator {
  rpc InitSignUp(InitSignUpRequest) returns (InitSignUpResponse) {
    option (google.api.http) = {
      post: "/api/v1/signup/init"
      body: "*"
    };
  }

  rpc SignUp(SignUpRequest) returns (SignUpResponse) {
    option (google.api.http) = {
      post: "/api/v1/signup"
      body: "*"
    };
  }

  rpc InitFacebookLogin(InitFacebookLoginRequest) returns (InitFacebookLoginResponse) {
    option (google.api.http) = {
      get: "/api/v1/login/facebook/init"
    };
  }

  rpc HandleFacebookCallback(HandleFacebookCallbackRequest) returns (HandleFacebookCallbackResponse) {
//    option (google.api.http) = {
//      get: "/self-service/methods/oidc/callback/facebook"
//    };
  }
}

message InitSignUpRequest {
  string phone = 1;
}

message InitSignUpResponse {
  int32 code = 1;
  string message = 2;
  message Data {
    string flow_id = 3;
  }
}

message SignUpRequest {
  string flow_id = 1;
  string otp = 2;
}

message SignUpResponse {
  int32 code = 1;
  string message = 2;
  Data data = 3;

  message Data {
    string token = 1;
  }
}

message InitFacebookLoginRequest {
}

message InitFacebookLoginResponse {
  int32 code = 1;
  string message = 2;
  Data data = 3;
  message Data {
    string redirect_url = 1;
    repeated string cookies = 2;
  }
}

message HandleFacebookCallbackRequest {
  string code = 1;
  string state = 2;

  string error = 3;
  string error_description = 4;
  string error_reason = 5;

  string cookie_header = 6;
}

message HandleFacebookCallbackResponse {
  bool success = 1;
  string redirect_url = 2; // Where to redirect user after auth
  repeated Cookie session_cookies = 3; // Cookies to set in browser
  string error_message = 4;
}

message Cookie {
  string name = 1;
  string value = 2;
  string path = 3;
  string domain = 4;
  int64 max_age = 5;
  bool secure = 6;
  bool http_only = 7;
}